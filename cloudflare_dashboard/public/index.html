<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AC IR Remote Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="ac-manager.css" />
  </head>
  <body>
    <div class="bg-orb orb-a"></div>
    <div class="bg-orb orb-b"></div>

    <header class="topbar">
      <div class="brand">
        <span class="eyebrow">Cloud Control</span>
        <h1>AC IR Remote Command Center</h1>
        <p>
          Monitor live environment data and send IR commands through EMQX MQTT.
        </p>
      </div>
      <div class="status-stack">
        <div class="status-pill">
          <span class="dot" id="statusDot"></span>
          <span id="statusText">Checking status</span>
        </div>
        <div class="timestamp" id="lastUpdated">Last update: --</div>
      </div>
    </header>

    <main class="grid">
      <!-- AC Manager Section -->
      <section class="card hero-controls" style="--delay: 0.05s">
        <div id="ac-manager"></div>
      </section>

      <!-- Hidden elements for app.js compatibility -->
      <div style="display: none;">
        <span id="powerState"></span>
        <span id="currentTemp"></span>
        <span id="currentMode"></span>
        <span id="currentFan"></span>
        <span id="currentBrand"></span>
      </div>

      <section class="card alarms" style="--delay: 0.2s">
        <div class="card-header">
          <h2>Alarms</h2>
          <span class="chip subtle" id="alarmCount">0 saved</span>
        </div>
        <div class="alarm-table-head">
          <span>Slot</span>
          <span>Time</span>
          <span>Name</span>
          <span>Actions</span>
        </div>
        <div class="alarm-list" id="alarmList"></div>
        <div class="alarm-form">
          <div class="alarm-input">
            <label for="alarmTime">Time</label>
            <input type="time" id="alarmTime" value="07:00" />
          </div>
          <div class="alarm-input">
            <label for="alarmName">Name</label>
            <input type="text" id="alarmName" placeholder="alarm clock 1" maxlength="31" />
          </div>
          <button class="btn accent" id="alarmAddBtn">Add Alarm</button>
        </div>
        <p class="hint">Alarm updates are sent over MQTT and synced from Firebase.</p>
      </section>

      <section class="card sensors" style="--delay: 0.25s">
        <div class="card-header">
          <h2>Room Sensors</h2>
          <span class="chip" id="motionState">Motion: --</span>
        </div>
        <div class="sensor-grid">
          <div class="sensor">
            <span class="label">DHT Temp</span>
            <span id="dhtTemp">--</span>
          </div>
          <div class="sensor">
            <span class="label">DHT Humidity</span>
            <span id="dhtHumidity">--</span>
          </div>
          <div class="sensor">
            <span class="label">Light</span>
            <span id="lightLux">--</span>
          </div>
        </div>
        <div class="chart-block">
          <div class="chart-header">
            <div class="chart-title">
              <h3>Room History</h3>
              <span class="chart-meta" id="chartMeta">--</span>
            </div>
            <div class="chart-tabs" id="chartTabs" role="group" aria-label="Room history range">
              <button class="chart-tab" type="button" data-range="realtime">Realtime</button>
              <button class="chart-tab" type="button" data-range="hour">Hour</button>
              <button class="chart-tab" type="button" data-range="day">Day</button>
              <button class="chart-tab" type="button" data-range="week">Week</button>
            </div>
          </div>
          <div class="chart-body">
            <canvas id="roomChart"></canvas>
          </div>
        </div>
        <div class="chart-block">
          <div class="chart-header">
            <div class="chart-title">
              <h3>Light History</h3>
              <span class="chart-meta" id="lightChartMeta">--</span>
            </div>
            <div class="chart-tabs" id="lightChartTabs" role="group" aria-label="Light history range">
              <button class="chart-tab" type="button" data-range="realtime">Realtime</button>
              <button class="chart-tab" type="button" data-range="hour">Hour</button>
              <button class="chart-tab" type="button" data-range="day">Day</button>
              <button class="chart-tab" type="button" data-range="week">Week</button>
            </div>
          </div>
          <div class="chart-body">
            <canvas id="lightChart"></canvas>
          </div>
        </div>
      </section>

      <section class="card custom" style="--delay: 0.35s">
        <div class="card-header">
          <h2>Custom Signals</h2>
          <span class="chip subtle">Slots 1 to 5</span>
        </div>
        <div class="button-grid">
          <button class="btn" data-command="custom" data-id="1">Preset 1</button>
          <button class="btn" data-command="custom" data-id="2">Preset 2</button>
          <button class="btn" data-command="custom" data-id="3">Preset 3</button>
          <button class="btn" data-command="custom" data-id="4">Preset 4</button>
          <button class="btn" data-command="custom" data-id="5">Preset 5</button>
        </div>
        <p class="hint">
          Use the IR learning screen on the device to capture these presets.
        </p>
      </section>

      <section class="card device" style="--delay: 0.45s">
        <h2>Device Info</h2>
        <div class="device-grid">
          <div>
            <span class="label">Device ID</span>
            <span id="deviceIdValue">--</span>
          </div>
          <div>
            <span class="label">Status Timestamp</span>
            <span id="statusTimestamp">--</span>
          </div>
          <div>
            <span class="label">Uptime</span>
            <span id="uptime">--</span>
          </div>
          <div>
            <span class="label">Source</span>
            <span id="sourceHint">Firebase status_history</span>
          </div>
        </div>
      </section>

      <section class="card activity" style="--delay: 0.55s">
        <h2>Activity</h2>
        <ul id="activityList" class="activity-list"></ul>
      </section>
    </main>

    <footer class="footer">
      <span>ESP32-S3 AC Remote</span>
      <span>Cloudflare Worker dashboard</span>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="ac-manager.js"></script>
    <script src="app.js"></script>
  </body>
</html>
