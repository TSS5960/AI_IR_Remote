<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AC IR Remote Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="bg-orb orb-a"></div>
    <div class="bg-orb orb-b"></div>

    <header class="topbar">
      <div class="brand">
        <span class="eyebrow">Cloud Control</span>
        <h1>AC IR Remote Command Center</h1>
        <p>
          Monitor live environment data and send IR commands through EMQX MQTT.
        </p>
      </div>
      <div class="status-stack">
        <div class="status-pill">
          <span class="dot" id="statusDot"></span>
          <span id="statusText">Checking status</span>
        </div>
        <div class="timestamp" id="lastUpdated">Last update: --</div>
      </div>
    </header>

    <main class="grid">
      <section class="card hero-controls" style="--delay: 0.05s">
        <div class="hero-block">
          <div class="card-header">
            <h2>Live State</h2>
            <span class="chip" id="powerState">Power: --</span>
          </div>
          <div class="hero-temp">
            <div class="temp-value" id="currentTemp">--</div>
            <div class="temp-unit">â„ƒ</div>
          </div>
          <div class="hero-meta">
            <div>
              <span class="label">Mode</span>
              <span id="currentMode">--</span>
            </div>
            <div>
              <span class="label">Fan</span>
              <span id="currentFan">--</span>
            </div>
            <div>
              <span class="label">Brand</span>
              <span id="currentBrand">--</span>
            </div>
          </div>
          <div class="hero-actions">
            <div class="power-group">
              <button class="btn" id="powerOnBtn" data-command="power_on">Power On</button>
              <button class="btn" id="powerOffBtn" data-command="power_off">Power Off</button>
            </div>
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="controls-block">
          <h2>Temperature</h2>
          <div class="control-row">
            <button class="btn" data-command="temp_down" data-requires-power>Temp -</button>
            <input
              type="number"
              id="setTemp"
              min="16"
              max="30"
              step="1"
              value="24"
              data-requires-power
            />
            <button class="btn" data-command="temp_up" data-requires-power>Temp +</button>
            <button class="btn accent" id="setTempBtn" data-requires-power>Set Temp</button>
          </div>

          <h2>Mode</h2>
          <div class="button-grid">
            <button class="btn ghost" data-command="set_mode" data-value="auto" data-requires-power>
              Auto
            </button>
            <button class="btn ghost" data-command="set_mode" data-value="cool" data-requires-power>
              Cool
            </button>
            <button class="btn ghost" data-command="set_mode" data-value="heat" data-requires-power>
              Heat
            </button>
            <button class="btn ghost" data-command="set_mode" data-value="dry" data-requires-power>
              Dry
            </button>
            <button class="btn ghost" data-command="set_mode" data-value="fan" data-requires-power>
              Fan
            </button>
            <button class="btn" data-command="mode_cycle" data-requires-power>Cycle</button>
          </div>

          <h2>Fan Speed</h2>
          <div class="button-grid">
            <button class="btn ghost" data-command="set_fan" data-value="auto" data-requires-power>
              Auto
            </button>
            <button class="btn ghost" data-command="set_fan" data-value="low" data-requires-power>
              Low
            </button>
            <button class="btn ghost" data-command="set_fan" data-value="medium" data-requires-power>
              Medium
            </button>
            <button class="btn ghost" data-command="set_fan" data-value="high" data-requires-power>
              High
            </button>
            <button class="btn" data-command="fan_cycle" data-requires-power>Cycle</button>
          </div>

          <h2>Auto Dry</h2>
          <div class="auto-setting">
            <div class="auto-setting-row">
              <span class="label">Humidity Threshold</span>
              <span id="dryThresholdDisplay">--</span>
            </div>
            <div class="auto-setting-controls">
              <input
                type="range"
                id="dryThresholdRange"
                min="40"
                max="85"
                step="1"
                value="65"
              />
              <input
                type="number"
                id="dryThresholdValue"
                min="40"
                max="85"
                step="1"
                value="65"
              />
              <button class="btn accent" id="dryThresholdBtn">Set Threshold</button>
            </div>
            <p class="hint">
              When humidity exceeds the threshold, the device switches to Dry mode.
            </p>
          </div>

          <h2>Sleep Mode</h2>
          <div class="auto-setting">
            <div class="auto-setting-row">
              <span class="label">Light Threshold</span>
              <span id="sleepLightDisplay">--</span>
            </div>
            <div class="auto-setting-controls">
              <input
                type="range"
                id="sleepLightRange"
                min="1"
                max="1000"
                step="1"
                value="30"
              />
              <input
                type="number"
                id="sleepLightValue"
                min="1"
                max="1000"
                step="1"
                value="30"
              />
              <button class="btn accent" id="sleepLightBtn">Set Threshold</button>
            </div>
            <p class="hint">
              When light drops below the threshold, the fan speed is lowered.
            </p>
          </div>

          <h2>Brand</h2>
          <div class="brand-row">
            <select id="brandSelect">
              <option value="daikin">Daikin</option>
              <option value="mitsubishi">Mitsubishi</option>
              <option value="panasonic">Panasonic</option>
              <option value="gree">Gree</option>
              <option value="midea">Midea</option>
              <option value="haier">Haier</option>
              <option value="samsung">Samsung</option>
              <option value="lg">LG</option>
              <option value="fujitsu">Fujitsu</option>
              <option value="hitachi">Hitachi</option>
            </select>
            <button class="btn accent" id="setBrandBtn">Set Brand</button>
            <button class="btn" data-command="switch_brand">Cycle</button>
          </div>
        </div>
      </section>

      <section class="card alarms" style="--delay: 0.2s">
        <div class="card-header">
          <h2>Alarms</h2>
          <span class="chip subtle" id="alarmCount">0 saved</span>
        </div>
        <div class="alarm-table-head">
          <span>Slot</span>
          <span>Time</span>
          <span>Name</span>
          <span>Actions</span>
        </div>
        <div class="alarm-list" id="alarmList"></div>
        <div class="alarm-form">
          <div class="alarm-input">
            <label for="alarmTime">Time</label>
            <input type="time" id="alarmTime" value="07:00" />
          </div>
          <div class="alarm-input">
            <label for="alarmName">Name</label>
            <input type="text" id="alarmName" placeholder="alarm clock 1" maxlength="31" />
          </div>
          <button class="btn accent" id="alarmAddBtn">Add Alarm</button>
        </div>
        <p class="hint">Alarm updates are sent over MQTT and synced from Firebase.</p>
      </section>

      <section class="card sensors" style="--delay: 0.25s">
        <div class="card-header">
          <h2>Room Sensors</h2>
          <span class="chip" id="motionState">Motion: --</span>
        </div>
        <div class="sensor-grid">
          <div class="sensor">
            <span class="label">DHT Temp</span>
            <span id="dhtTemp">--</span>
          </div>
          <div class="sensor">
            <span class="label">DHT Humidity</span>
            <span id="dhtHumidity">--</span>
          </div>
          <div class="sensor">
            <span class="label">Light</span>
            <span id="lightLux">--</span>
          </div>
        </div>
        <div class="chart-block">
          <div class="chart-header">
            <div class="chart-title">
              <h3>Room History</h3>
              <span class="chart-meta" id="chartMeta">--</span>
            </div>
            <div class="chart-tabs" id="chartTabs" role="group" aria-label="Room history range">
              <button class="chart-tab" type="button" data-range="realtime">Realtime</button>
              <button class="chart-tab" type="button" data-range="hour">Hour</button>
              <button class="chart-tab" type="button" data-range="day">Day</button>
              <button class="chart-tab" type="button" data-range="week">Week</button>
            </div>
          </div>
          <div class="chart-body">
            <canvas id="roomChart"></canvas>
          </div>
        </div>
        <div class="chart-block">
          <div class="chart-header">
            <div class="chart-title">
              <h3>Light History</h3>
              <span class="chart-meta" id="lightChartMeta">--</span>
            </div>
            <div class="chart-tabs" id="lightChartTabs" role="group" aria-label="Light history range">
              <button class="chart-tab" type="button" data-range="realtime">Realtime</button>
              <button class="chart-tab" type="button" data-range="hour">Hour</button>
              <button class="chart-tab" type="button" data-range="day">Day</button>
              <button class="chart-tab" type="button" data-range="week">Week</button>
            </div>
          </div>
          <div class="chart-body">
            <canvas id="lightChart"></canvas>
          </div>
        </div>
      </section>

      <section class="card custom" style="--delay: 0.35s">
        <div class="card-header">
          <h2>Custom Signals</h2>
          <span class="chip subtle">Slots 1 to 5</span>
        </div>
        <div class="button-grid">
          <button class="btn" data-command="custom" data-id="1">Preset 1</button>
          <button class="btn" data-command="custom" data-id="2">Preset 2</button>
          <button class="btn" data-command="custom" data-id="3">Preset 3</button>
          <button class="btn" data-command="custom" data-id="4">Preset 4</button>
          <button class="btn" data-command="custom" data-id="5">Preset 5</button>
        </div>
        <p class="hint">
          Use the IR learning screen on the device to capture these presets.
        </p>
      </section>

      <section class="card device" style="--delay: 0.45s">
        <h2>Device Info</h2>
        <div class="device-grid">
          <div>
            <span class="label">Device ID</span>
            <span id="deviceIdValue">--</span>
          </div>
          <div>
            <span class="label">Status Timestamp</span>
            <span id="statusTimestamp">--</span>
          </div>
          <div>
            <span class="label">Uptime</span>
            <span id="uptime">--</span>
          </div>
          <div>
            <span class="label">Source</span>
            <span id="sourceHint">Firebase status_history</span>
          </div>
        </div>
      </section>

      <section class="card activity" style="--delay: 0.55s">
        <h2>Activity</h2>
        <ul id="activityList" class="activity-list"></ul>
      </section>
    </main>

    <footer class="footer">
      <span>ESP32-S3 AC Remote</span>
      <span>Cloudflare Worker dashboard</span>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
